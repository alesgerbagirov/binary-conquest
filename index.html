<!doctype html>
<html lang="az">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Binary Conquest — Oyun</title>
<style>
  :root{
    --bg:#0d1117; --panel:#111827; --card:#151b2c;
    --text:#e6eaff; --muted:#b8c0d7; --accent:#5b9cff;
    --grid:#9aa0a6; --empty:#f0f0f0; --lime:#37ff5b; --red:#ff3b3b;
    --win:#10b981; --lose:#ef4444; --draw:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(135deg,#0b1220,#0e1629 40%,#0a1020);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .container{max-width:1200px;margin:0 auto;padding:20px}
  header.nav{position:sticky;top:0;z-index:20;background:rgba(13,17,23,.7);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
  .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:10px 0}
  .brand{display:flex;align-items:center;gap:10px}
  .brand .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#2e72ff,#00e0ff);box-shadow:0 8px 30px rgba(46,114,255,.35)}
  .pill{background:#192033;border:1px solid rgba(255,255,255,.06);color:var(--muted);padding:6px 10px;border-radius:999px;font-size:13px}
  .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:20px;margin:22px 0 12px}
  @media (max-width:980px){ .hero{grid-template-columns:1fr} }
  .board-card{background:radial-gradient(1200px 500px at -10% -10%, #1a2440 0%, #0f1425 60%, #0c1120 100%);
    border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:16px}
  .board-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .panel{background:linear-gradient(180deg,#101629,#0c1222);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:14px;display:flex;flex-direction:column;gap:10px}
  .group{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:12px}
  .group h3{margin:0 0 8px;font-size:14px;color:var(--muted);letter-spacing:.3px;text-transform:uppercase}
  label{font-size:14px;color:var(--muted)}
  select,input[type="number"]{margin-left:6px;background:#0d1324;color:var(--text);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:6px 8px}
  button{background:var(--accent);color:#fff;border:0;border-radius:12px;padding:8px 14px;font-weight:600;cursor:pointer}
  button.ghost{background:#1a2340}
  #boardBox{position:relative}
  #canvas{display:block;width:100%;height:auto;max-height:70vh;border-radius:12px}
  #overlay{position:absolute;inset:0;display:none;background:rgba(0,0,0,.55);align-items:center;justify-content:center;text-align:center;border-radius:12px}
  #overlay .inner{background:#0f1320;color:#fff;padding:18px 22px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4);min-width:300px}
  .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px}
  .win{background:rgba(16,185,129,.15);border:1px solid rgba(16,185,129,.35)}
  .lose{background:rgba(239,68,68,.15); border:1px solid rgba(239,68,68,.35)}
  .draw{background:rgba(245,158,11,.15); border:1px solid rgba(245,158,11,.35)}
  footer{margin:24px 0;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
</style>
</head>
<body>
<header class="nav">
  <div class="container nav-inner">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <b>Binary Conquest</b><div style="color:#b8c0d7;font-size:13px">0/1 strategiya oyunu • brauzerdə</div>
      </div>
    </div>
    <div class="pill">R → Restart</div>
  </div>
</header>

<div class="container hero">
  <!-- Sol: Oyun -->
  <section class="board-card">
    <div class="board-head">
      <h2>Lövhə</h2>
      <div id="info">Gediş: <b id="turnWho">A (0)</b></div>
    </div>
    <div id="boardBox">
      <canvas id="canvas" width="900" height="700"></canvas>
      <div id="overlay">
        <div class="inner">
          <h4 id="result"></h4>
          <div id="badgeRow" style="margin:6px 0 12px"></div>
          <div style="display:flex;gap:10px;justify-content:center">
            <button id="yesBtn">Yenidən başla</button>
            <button id="noBtn" class="ghost">Bağla</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Sağ: Parametrlər -->
  <aside class="panel">
    <div class="group">
      <h3>Parametrlər</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <label>Rejim:
          <select id="mode">
            <option value="hvc" selected>Human vs Computer</option>
            <option value="hvh">Human vs Human</option>
          </select>
        </label>
        <label>AI:
          <select id="aiLevel">
            <option value="EASY">EASY</option>
            <option value="MEDIUM">MEDIUM</option>
            <option value="HARD" selected>HARD</option>
          </select>
        </label>
        <label>Board:
          <input id="size" type="number" min="3" max="15" value="7" />
        </label>
        <label>Hüceyrə px:
          <input id="cell" type="number" min="28" max="100" value="64" />
        </label>
        <label style="grid-column:1/-1"><input id="toggle" type="checkbox" checked /> Dolu xananı kliklə boşalt</label>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="restartBtn">Restart</button>
        <button id="clearBtn" class="ghost">Hamısını sil</button>
      </div>
    </div>
  </aside>
</div>

<footer class="container">
  <div>© 2025 Binary Conquest</div>
  <div>İpucu: HARD rejim diaqonallarda aqressiv bloklayır.</div>
</footer>

<script>
(() => {
  // ---------- Canvas / DOM ----------
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d', { alpha:false });
  const overlay = document.getElementById('overlay');
  const resultEl = document.getElementById('result');
  const badgeRow = document.getElementById('badgeRow');
  const turnWhoEl = document.getElementById('turnWho');
  const modeSel = document.getElementById('mode');
  const aiSel = document.getElementById('aiLevel');
  const sizeInp = document.getElementById('size');
  const cellInp = document.getElementById('cell');
  const toggleInp = document.getElementById('toggle');
  const restartBtn = document.getElementById('restartBtn');
  const clearBtn = document.getElementById('clearBtn');

  // ---------- WebAudio: yumşaq, cızıltısız arxafon (auto-start/stop) ----------
  let audioCtx, masterGain, musicGain, sfxGain;
  let seqTimer = null;            // interval id
  let firstGestureDone = false;   // autoplay üçün ilk gesture
  let musicActive = false;

  function ensureAudio(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    musicGain  = audioCtx.createGain();
    sfxGain    = audioCtx.createGain();
    masterGain.gain.value = 1.0;
    musicGain.gain.value  = 0.28; // sakit
    sfxGain.gain.value    = 0.9;
    musicGain.connect(masterGain);
    sfxGain.connect(masterGain);
    masterGain.connect(audioCtx.destination);
  }

  // Zərif not generatoru (pop/cızıltısız ADSR + LPF)
  function playNote(freq, when, dur=0.28){
    ensureAudio();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    const f = audioCtx.createBiquadFilter();
    o.type="triangle";
    f.type="lowpass"; f.frequency.value=900; f.Q.value=0.7;

    o.frequency.setValueAtTime(freq, when);
    g.gain.setValueAtTime(0.0001, when);
    g.gain.exponentialRampToValueAtTime(0.18, when+0.02);    // attack
    g.gain.exponentialRampToValueAtTime(0.0001, when+dur);   // release

    o.connect(g); g.connect(f); f.connect(musicGain);
    o.start(when);
    o.stop(when + dur + 0.05);
  }

  // Sadə, xoş döngü: Cmaj7 → Am7 → Fmaj7 → G
  const PROG = [
    [261.63, 329.63, 392.00],   // C E G
    [220.00, 261.63, 329.63],   // A C E
    [174.61, 220.00, 349.23],   // F A F üstlə
    [196.00, 246.94, 392.00],   // G B G
  ];
  function startMusicLoop(){
    if(musicActive) return;
    ensureAudio();
    const beatMs = 600; // 100bpm təxmini
    let step = 0;
    // ilk dəfə dərhal səslə
    scheduleChord(step);
    step = (step+1)%PROG.length;

    seqTimer = setInterval(()=>{
      // brauzer CPU tərpənişlərinə həssas olmasın deyə `currentTime` ilə planla
      const t = audioCtx.currentTime + 0.02;
      scheduleChord(step, t);
      step = (step+1)%PROG.length;
    }, beatMs);
    musicActive = true;
  }
  function scheduleChord(step, when){
    const chord = PROG[step];
    const t = when || (audioCtx.currentTime + 0.02);
    // arpej effekti: kiçik gecikmə ilə səslə
    playNote(chord[0], t+0.00, 0.34);
    playNote(chord[1], t+0.06, 0.30);
    playNote(chord[2], t+0.12, 0.28);
  }
  function stopMusicLoop(){
    if(!musicActive) return;
    if(seqTimer){ clearInterval(seqTimer); seqTimer=null; }
    // yumşaq fade-out
    const now = audioCtx.currentTime;
    musicGain.gain.cancelScheduledValues(now);
    musicGain.gain.setTargetAtTime(0.0001, now, 0.25);
    setTimeout(()=>{ musicGain.gain.value = 0.28; }, 500);
    musicActive = false;
  }
  function duckMusicBrief(){
    if(!audioCtx) return;
    const now = audioCtx.currentTime;
    const back = 0.28;
    musicGain.gain.setTargetAtTime(Math.max(0, back-0.18), now, 0.02);
    musicGain.gain.setTargetAtTime(back, now+0.6, 0.2);
  }

  // İlkin gesture: ilk klik/klaviatura ilə audio aç
  function primeAudioGesture(){
    if(firstGestureDone) return;
    ensureAudio();
    audioCtx.resume().then(()=>{ firstGestureDone = true; });
  }
  window.addEventListener('pointerdown', primeAudioGesture, { once:true });
  window.addEventListener('keydown', primeAudioGesture, { once:true });

  // ---------- Daxili Nəticə SFX-ləri ----------
  function tone(freq, dur=0.22, type="sine", start=0){
    ensureAudio();
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type=type; o.frequency.setValueAtTime(freq, audioCtx.currentTime+start);
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime+start);
    g.gain.exponentialRampToValueAtTime(0.7, audioCtx.currentTime+start+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+start+dur);
    o.connect(g); g.connect(sfxGain);
    o.start(audioCtx.currentTime+start);
    o.stop(audioCtx.currentTime+start+dur+0.03);
  }
  function chord(freqs, dur=0.25, type="sine", start=0){ freqs.forEach(f=>tone(f,dur,type,start)); }
  function sfxWin(){ duckMusicBrief(); chord([523.25,659.25,783.99],0.18,"triangle",0.00); chord([659.25,783.99,987.77],0.18,"triangle",0.18); chord([523.25,659.25,783.99,1046.5],0.32,"sawtooth",0.36); }
  function sfxLose(){ duckMusicBrief(); tone(440,0.22,"square",0.00); tone(369.99,0.22,"square",0.18); tone(329.63,0.34,"triangle",0.36); }
  function sfxDraw(){ duckMusicBrief(); chord([392.00,587.33],0.22,"sine",0.00); chord([392.00,587.33],0.22,"sine",0.22); }

  // ---------- Oyun vəziyyəti ----------
  let N = Number(sizeInp.value);
  let CELL = Number(cellInp.value);
  const OFFSET_X = 30, OFFSET_Y = 70;
  let board = [];
  let current = 'A'; // Human A
  let gameActive = true, showPrompt = false;
  let playVsAI = (modeSel.value==='hvc');
  let AI_LEVEL = aiSel.value;
  let ALLOW_TOGGLE = toggleInp.checked;
  let musicStartedForThisRound = false; // oyuna başlayan kimi musiqini bir dəfə aç

  // ---------- Util ----------
  const COLOR = { grid:'#9aa0a6', empty:'#f0f0f0', A:'#37ff5b', B:'#ff3b3b' };
  const idx=(r,c)=>r*N+c;
  const empties=a=>{const o=[];for(let i=0;i<a.length;i++) if(a[i]==='') o.push(i); return o;};

  function resizeCanvas(){
    const W = Math.min(900, document.getElementById('boardBox').clientWidth);
    canvas.width  = Math.max(OFFSET_X*2 + N*CELL + 40, W);
    canvas.height = OFFSET_Y*2 + N*CELL + 60;
  }
  function initBoard(clearOnly=false){
    if(clearOnly){ board = Array(N*N).fill(''); draw(); return; }
    board = Array(N*N).fill(''); current='A'; gameActive=true; showPrompt=false;
    overlay.style.display='none'; turnWhoEl.textContent='A (0)'; draw();
    // yeni raund: musiqi növbəti hərəkətdə avtomatik start edəcək
    musicStartedForThisRound = false;
  }

  // ---------- Hesablama ----------
  function computeMaxSequences(arr){
    let maxA=0,maxB=0;
    for(let r=0;r<N;r++){ let a=0,b=0; for(let c=0;c<N;c++){ const v=arr[idx(r,c)];
      if(v==='A'){ a++; b=0; if(a>maxA) maxA=a; } else if(v==='B'){ b++; a=0; if(b>maxB) maxB=b; } else { a=0; b=0; }
    } }
    for(let c=0;c<N;c++){ let a=0,b=0; for(let r=0;r<N;r++){ const v=arr[idx(r,c)];
      if(v==='A'){ a++; b=0; if(a>maxA) maxA=a; } else if(v==='B'){ b++; a=0; if(b>maxB) maxB=b; } else { a=0; b=0; }
    } }
    for(let sc=0;sc<N;sc++){ let a=0,b=0; for(let r=0,c=sc;r<N&&c<N;r++,c++){ const v=arr[idx(r,c)];
      if(v==='A'){ a++; b=0; if(a>maxA) maxA=a; } else if(v==='B'){ b++; a=0; if(b>maxB) maxB=b; } else { a=0; b=0; }
    } }
    for(let sr=1;sr<N;sr++){ let a=0,b=0; for(let r=sr,c=0;r<N&&c<N;r++,c++){ const v=arr[idx(r,c)];
      if(v==='A'){ a++; b=0; if(a>maxA) maxA=a; } else if(v==='B'){ b++; a=0; if(b>maxB) maxB=b; } else { a=0; b=0; }
    } }
    for(let sc=0;sc<N;sc++){ let a=0,b=0; for(let r=0,c=sc;r<N&&c>=0;r++,c--){ const v=arr[idx(r,c)];
      if(v==='A'){ a++; b=0; if(a>maxA) maxA=a; } else if(v==='B'){ b++; a=0; if(b>maxB) maxB=b; } else { a=0; b=0; }
    } }
    for(let sr=1;sr<N;sr++){ let a=0,b=0; for(let r=sr,c=N-1;r<N&&c>=0;r++,c--){ const v=arr[idx(r,c)];
      if(v==='A'){ a++; b=0; if(a>maxA) maxA=a; } else if(v==='B'){ b++; a=0; if(b>maxB) maxB=b; } else { a=0; b=0; }
    } }
    return [maxA,maxB];
  }
  function countRun(arr,r,c,dr,dc,who){ let rr=r,cc=c,cnt=0; while(rr>=0&&rr<N&&cc>=0&&cc<N&&arr[idx(rr,cc)]===who){ cnt++; rr+=dr; cc+=dc; } return cnt; }
  function linePotentialIf(arr,i,who){
    const r=Math.floor(i/N), c=i%N;
    const h=1+countRun(arr,r,c-1,0,-1,who)+countRun(arr,r,c+1,0,1,who);
    const v=1+countRun(arr,r-1,c,-1,0,who)+countRun(arr,r+1,c,1,0,who);
    const d1=1+countRun(arr,r-1,c-1,-1,-1,who)+countRun(arr,r+1,c+1,1,1,who);
    const d2=1+countRun(arr,r-1,c+1,-1,1,who)+countRun(arr,r+1,c-1,1,-1,who);
    return {h,v,d1,d2,max:Math.max(h,v,d1,d2)};
  }
  function threatScoreA(arr,i){ const p=linePotentialIf(arr,i,'A'); const diagBoost=(p.d1>=p.max)?0.4:0; return p.max+diagBoost; }

  // ---------- Bitmə & SFX ----------
  function showEndPrompt(msg, type){
    gameActive=false; showPrompt=true; resultEl.textContent=msg;
    badgeRow.innerHTML=""; const b=document.createElement('span'); b.className="badge "+(type==='win'?'win':(type==='lose'?'lose':'draw'));
    b.textContent= type==='win'?'Qələbə!':(type==='lose'?'Məğlubiyyət':'Bərabərlik'); badgeRow.appendChild(b);
    overlay.style.display='flex';
  }
  function finishIfEnded(){
    for(let i=0;i<board.length;i++) if(board[i]==='') return;
    const [maxA,maxB]=computeMaxSequences(board);
    let msg='', type='draw';
    if(maxA>maxB){ msg=`Player A (0) qalib! Max ardıcıllıq: ${maxA}`; type='win'; sfxWin(); }
    else if(maxB>maxA){ msg=`Player B (1) qalib! Max ardıcıllıq: ${maxB}`; type='lose'; sfxLose(); }
    else { msg=`Bərabərlik! Max ardıcıllıq: ${maxA}`; type='draw'; sfxDraw(); }
    showEndPrompt(msg,type);
    // oyun bitən kimi musiqini söndür
    stopMusicLoop();
  }

  // ---------- AI ----------
  function simPlace(arr,i,who){ const t=arr.slice(); t[i]=who; return t; }
  function selfImproveDeltaB(){
    const em=empties(board); if(!em.length) return {idx:-1,gain:-1,tieA:1e9};
    const [curA,curB]=computeMaxSequences(board);
    let bestIdx=-1,bestGain=-1,tieMinA=1e9;
    for(const i of em){
      const tmp=simPlace(board,i,'B'); const [sA,sB]=computeMaxSequences(tmp);
      const gain=sB-curB; if(gain>bestGain||(gain===bestGain&&sA<tieMinA)){bestIdx=i;bestGain=gain;tieMinA=sA;}
    }
    return {idx:bestIdx,gain:bestGain,tieA:tieMinA};
  }
  function computerMove(){
    const em=empties(board); if(!em.length) return; let chosen=-1;
    if(AI_LEVEL==='EASY'){ chosen=em[Math.floor(Math.random()*em.length)];
    }else if(AI_LEVEL==='MEDIUM'){ const self=selfImproveDeltaB(); chosen=(self.idx>=0&&self.gain>0)?self.idx:em[Math.floor(Math.random()*em.length)];
    }else{ // HARD: əvvəl blok, sonra özünü-yaxşılaşdır
      let worstIdx=-1,worstScore=-1; for(const i of em){ const sc=threatScoreA(board,i); if(sc>worstScore){worstScore=sc;worstIdx=i;} }
      const self=selfImproveDeltaB(); const blockFirst=(worstScore>=3)||(self.gain<=1)||(worstScore>=self.gain+0.5);
      if(blockFirst&&worstIdx>=0) chosen=worstIdx;
      else if(self.idx>=0&&self.gain>0) chosen=self.idx;
      else{ let potBest=-1,potIdx=-1; for(const i of em){ const p=linePotentialIf(board,i,'A'); const val=p.max+((p.d1===p.max)?0.2:0); if(val>potBest){potBest=val;potIdx=i;} }
        chosen=(potIdx>=0)?potIdx:em[Math.floor(Math.random()*em.length)];
      }
    }
    board[chosen]='B'; current='A'; turnWhoEl.textContent='A (0)'; finishIfEnded(); draw();
  }

  // ---------- Draw ----------
  function draw(){
    resizeCanvas(); ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#e6eaff'; ctx.font='600 22px system-ui';
    ctx.fillText(`Rejim: ${playVsAI?'Human vs Computer':'Human vs Human'}  •  AI: ${AI_LEVEL}`, 30, 36);
    ctx.fillStyle='#b8c0d7'; ctx.font='16px system-ui';
    ctx.fillText(`Gediş: ${current==='A'?'A (0)':'B (1)'}   |   [R] Restart`, 30, 58);

    for(let r=0;r<N;r++){ for(let c=0;c<N;c++){
      const x=30+c*CELL, y=70+r*CELL, w=CELL-2, h=CELL-2;
      const v=board[idx(r,c)];
      ctx.fillStyle = v===''? '#f0f0f0' : (v==='A'?'#37ff5b':'#ff3b3b');
      roundRect(x,y,w,h,10,true,false);
      ctx.strokeStyle='#9aa0a6'; ctx.lineWidth=1; roundRect(x,y,w,h,10,false,true);
      if(v!==''){ ctx.fillStyle='#000'; ctx.font='bold 24px system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.fillText(v==='A'?'0':'1', x+w/2, y+h/2); ctx.textAlign='start'; ctx.textBaseline='alphabetic';
      }
    }}
  }
  function roundRect(x,y,w,h,r,fill,stroke){
    ctx.beginPath(); ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath();
    if(fill) ctx.fill(); if(stroke) ctx.stroke();
  }

  // ---------- Overlay ----------
  function showPromptClose(){ overlay.style.display='none'; showPrompt=false; }
  document.getElementById('yesBtn').addEventListener('click', ()=>initBoard());
  document.getElementById('noBtn').addEventListener('click', showPromptClose);

  // ---------- Input (miqyaslanmış) ----------
  function cellAtPageXY(px,py){
    const rect=canvas.getBoundingClientRect(); const sx=canvas.width/rect.width; const sy=canvas.height/rect.height;
    const x=(px-rect.left)*sx, y=(py-rect.top)*sy;
    if(x<30||y<70) return -1;
    const c=Math.floor((x-30)/CELL), r=Math.floor((y-70)/CELL);
    return (r>=0&&r<N&&c>=0&&c<N)? idx(r,c) : -1;
  }
  canvas.addEventListener('mousedown',(e)=>{
    if(!gameActive||showPrompt) return;

    // Musiqini oyunla birlikdə avtomatik başlat (ilk hərəkət zamanı, ilk gesture-dən sonra)
    if(!musicStartedForThisRound){
      primeAudioGesture(); // ehtiyat üçün
      startMusicLoop();
      musicStartedForThisRound = true;
    }

    const i=cellAtPageXY(e.clientX,e.clientY); if(i<0) return;
    if(ALLOW_TOGGLE&&board[i]!==''){ board[i]=''; draw(); return; }
    if(board[i]===''){
      if(playVsAI && current!=='A') return;
      board[i]=current; current=(current==='A')?'B':'A'; turnWhoEl.textContent=(current==='A')?'A (0)':'B (1)';
      finishIfEnded(); draw();
      if(playVsAI&&gameActive&&current==='B'){ setTimeout(()=>{ if(gameActive&&current==='B') computerMove(); }, 90); }
    }
  });

  // ---------- UI ----------
  restartBtn.addEventListener('click', ()=>initBoard());
  clearBtn.addEventListener('click', ()=>initBoard(true));
  window.addEventListener('keydown',(e)=>{
    if(e.key==='r'||e.key==='R') initBoard();
    if(showPrompt){ if(e.key==='Enter'||e.key==='y') initBoard(); if(e.key==='Escape'||e.key==='n') showPromptClose(); }
  });
  window.addEventListener('resize', draw);
  modeSel.addEventListener('change', ()=>{ playVsAI=(modeSel.value==='hvc'); initBoard(); });
  aiSel.addEventListener('change', ()=>{ AI_LEVEL=aiSel.value; draw(); });
  sizeInp.addEventListener('change', ()=>{ N=Math.max(3,Math.min(15,Number(sizeInp.value||7))); initBoard(); });
  cellInp.addEventListener('change', ()=>{ CELL=Math.max(28,Math.min(100,Number(cellInp.value||64))); draw(); });
  toggleInp.addEventListener('change', ()=>{ ALLOW_TOGGLE=toggleInp.checked; });

  // ---------- Start ----------
  initBoard();
})();
</script>
</body>
</html>
